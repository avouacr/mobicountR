# Application to home detection in the absence of technical information on antennae {#orange2007}

In this section, we present an application of the bayesian framework to resident population estimation using a 2007 dataset from French MNO Orange. Since no technical information on antennae are available for these data, we rely on the Voronoi approximation to model coverage areas, similarly to previous studies based on this dataset. The bayesian model is used to map events observed at Voronoi level on a regular grid in a probabilized way. This interpolation enables us to make use of available prior information on grid tiles. We provide multiple evidence that the bayesian model substantially improves population estimates as compared to baseline from previous works. 

## Data

### Mobile phone data

This analysis is based on a 2007 pseudonymised call detail records (CDR) dataset from major French MNO Orange. CDR keep tracks of mobile phone users activity, such as sending or receiving a call or a text message. As shown in table \@ref(tab:exampleCDR2007), we know for each event the unique identifiers of the caller and the callee, event type, duration, and the unique identifier of the cell. Five months of exhaustive activity of more than 18 million Orange customers is available, representing around 15 billion events.

As detailed below, we validate our population estimates using localized tax data. These data give information on legal residence of French households, and so characterize resident population. For the comparison to be relevant, we focus on home detection, i.e. predicting people likely place of residence. This is done by subsetting mobile phone data at two temporal levels. First, we limit the analysis to September 2007 data, so as to measure a concept of mensual residence. Besides, September is the month with less holiday of the time period (June-October) we have access to. Finally, another reason is purely technical : the probabilistic method of localization we implement is much more computationally intensive than previous methods in the literature, which relied on deterministic home detection. This restriction thus also serves to limit computational load. Similarly, we restrict daily tracks to the 19:00-09:00 time span. This choice is based on results presented by Vanhoof et al. (2018), who find that this particular time interval maximizes correlation between population estimates and validation data.

We shall already outline an important limitation of this dataset. In 2007, mobile phone use wasn't nearly as ubiquitous as it is today. Besides, as these data come from CDR, only users actions are recorded, but not automatic connections of mobile phones to the network — as opposed to signalling data. A direct result of these shortcomings is temporal scarcity of individual tracks (figure \@ref(fig:statsdescusers2007)). Half of Orange customers use their phone at least three times a day, with a high heterogeneity between them in this regard. Yet, most users appear regularly in the dataset over the month, which is useful as we seek to analyse regularity of their location. Not surprisingly, these statistics drop when we restrict the time range to 19:00-09:00. Despite this obvious limitation, we are still able to observe most users at least 7 times during the month for an average of two events per night.

<!-- -------------------------------------------------------------------------- -->

\begin{table}[]
\caption{Orange 2007 CDR : example}
\label{tab:exampleCDR2007}
\centering
\begin{tabular}{p{0.235\linewidth}ccccccc}
\toprule
Timestamp & Caller & Callee & Event & Duration (sec.) & Area\_id & Cell\_id \\
\midrule
2007/10/01 12:09:55 & HJT22RR1 & R482GH001 & VO & 365 & 1548 & 530012 \\
2007/10/01 12:10:32 & TR001BB & 25GG2477 & SMS & 12 & 32110 & 255337 \\
\bottomrule
\end{tabular}
\end{table}

<!-- -------------------------------------------------------------------------- -->

\begin{figure}[t]
\caption{Orange 2007 CDR : summary statistics of users activity in September}
\label{fig:statsdescusers2007}
\centering

\subfloat[][Average number of daily events per user]{
\includegraphics[width=0.44\textwidth]{sections/3_orange2007/stats_desc_daily_events.jpg}}
\qquad
\subfloat[][Number of distinct days users appear]{
\includegraphics[width=0.44\textwidth]{sections/3_orange2007/stats_desc_nb_distinct_days.jpg}}

\end{figure}

<!-- -------------------------------------------------------------------------- -->

### Prior information on grid tiles

Various data sources can be mobilized to add prior information on tiles of the grid. Relevant source choice for prior depends on the exact concept of present population we seek to measure. As we choose to focus on nightly present population, we want a prior which gives more weight in the localization of mobile phone users to residential areas. We can't choose geolocated tax data for this purpose as we already use it as validation dataset.

Against that background, we resort to the BD TOPO, a dataset on land cover and land use maintained by the French mapping agency (IGN). The BD TOPO provides a three-dimensional vectorial description of French territory elements (forest, hydrography...) and infrastructures (transport infrastructures, energy networks...). Notably, it provides an exhaustive vectorial description of buildings, classified in various types based on their use. As we seek to measure nightly present population, we focus on the "other building" type (*bâti indifférencié*), described as buildings with a minimal area of 20 m² which does not possess any attributed function. This type of building mainly consists in housing, but also encompasses public buildings which can't be classified in other types, such as schools, hospitals, museums, etc. In order to get the best approximation of the number of people residing in each tile of the grid, we take advantage of the presence of building heights in the dataset to compute a building volume per tile[^height_imputation]. This volume is then normalized over the grid to get a probability distribution which can be used as prior in the bayesian model.

[^height_imputation]: Height is missing for about 10 % of buildings. We impute them using closest neighbour rule inside each department.

<!-- -------------------------------------------------------------------------- -->

### Validation data

In order to be able to estimate potential quality gain of population counts due to the bayesian framework, we need to compare our estimates to a validation dataset. However, in most applications involving mobile phone data, no ground truth data are available. As a result, most authors in the literature resort to "high-level" validation data by comparing their estimates with population counts from census data (Deville et al., 2014). This solution is problematic in the sense that it doesn't enable the creation of performance metrics at individual level to optimize location algorithms. However, in absence of such ground truth data, "high-level" validation data still appear as a satisfying solution to validate population estimates.

Localized tax data can be useful as a validation tool for population estimates (Vanhoof et al., 2018). Here, we use Insee (French National Institute of Statistics and Economic Studies) localized tax income device (RFL). This dataset gives information on the fiscal income at residence level for more than 26 million French households. For our purpose, its main interest is that it is geocoded, so that we have access to the number of people in each household as well as geographic coordinates of their (tax) residence. Using these coordinates, we attribute each household of the dataset to the grid tile in which its residence is located. As a result, we obtain resident population counts over the same grid on which we map mobile phone events, which can then be uses as a benchmark for our population estimates.

One important limitation of this dataset is that we use 2011 income tax year, since it is the oldest available year for which tax data were exhaustive. We thus make the assumption that population patterns did not change much during this time span.

<!-- -------------------------------------------------------------------------- -->

## Methodology

### Implementation of the bayesian framework in the absence of technical data on antennae

The Orange 2007 CDR dataset has been extensively studied in the litterature. As no technical information on antennae is available for these data, most of these works rely on the Voronoi tessellation approximation (Vanhoof et al., 2018 ; Galiana et al., 2018 ; Sakarovitch et al., 2019). Besides, home detection is generally performed in a deterministic way, in the sense that a single most likely place of residence is assigned to each phone user. This allocation is performed using various heuristics, such as maximum activity ("home is the cell tower where most activities of the user occurred during a specific observation period") or distinct days ("home is the cell tower where the maximum active days of a user were observed during a specific observation period") [see Vanhoof et al., 2018 for a detailed presentation of possible heuristics and their respective performance].

Since no technical information on antennae is available, we can't fully abstract ourselves from the Voronoi approximation : for each phone event, the only geographical information we have are coordinates of the antenna which processed the action. However, for the reasons explained in section \@ref(framework), we want to be able to map events on a given input grid rather than Voronoi tessellation, which sizes only depend on the spatial distribution of antennae. Similarly to Galiana et al. (2018), we interpolate events from the Voronoi tessellation to a regular grid composed of tiles of 500x500 meters, covering metropolitan France. Such a grid offers a good compromise between fine spatial resolution of the mapping and computational load. Table \@ref(tab:statspatialunits2007) provides descriptive statistics on the different spatial units used and their relations.

\begin{table}[t]
\caption{Descriptive statistics on spatial units}
\label{tab:statspatialunits2007}
\centering
\begin{tabular}{p{0.3\linewidth}ccccccccc}
\toprule
& mean & s.d. & min & P10 & P25 & median & P75 & P90 & max  \\
\midrule
Number of tiles per Voronoi polygon & $142$ & $179$ & $1$ & $4$ & $12$ & $62$ & $224$ & $390$ & $1,788$ \\
Number of Voronoi polygons per tile & $1$ & $0$ & $1$ & $1$ & $1$ & $1$ & $1$ & $2$ & $28$ \\
\midrule
\multicolumn{4}{l}{Number of Voronoi polygons: } & \multicolumn{2}{c}{18,084} \\
\multicolumn{4}{l}{Number of tiles:} & \multicolumn{2}{c}{2,166,965} \\
\bottomrule
\end{tabular}
\end{table}

The bayesian framework makes it possible to transition from Voronoi polygons $(v_j)_j$ to tiles $(t_i)_i$ of the grid in a probabilistic way, while at the same time incorporating prior information on the grid. We adjust the general framework presented in section \@ref(framework) to this specific use case :
\begingroup \large
$$\mathbb{P}(t_i | v_j) \propto \mathbb{P}(t_i) \mathbb{P}(v_j | t_i)$$
\endgroup
Given that a phone event has been observed in a Voronoi polygon $j$ — which is equivalent to say that it has been observed by the associated antenna (cell) $j$ — we are interested in computing the posterior distribution $(\mathbb{P}(t_i | v_j))_i$ in order to map this event to the grid. As no information on antennae coverage areas is available, we use simple areal weighting to model the likelihood :
\begingroup \large
$$
\mathbb{P}(v_j | t_i) =\frac{s(t_i \cap v_j)}{s(v_j)}
$$
\endgroup
where $s(t_i \cap v_j)$ is the area of the intersection between tile $i$ and Voronoi polygon $j$, and $s(v_j)$ is the total area of Voronoi polygon $j$. Any probability distribution over tiles $(\mathbb{P}(t_i))_i$ can be used as prior information.

At the level of a given individual, we thus transition from a track made of individual events $(v_{j_1}, ..., v_{j_m})$ observed with certainty at Voronoi level to a larger sequence of events $((c_{i_1}, ..., c_{i_n}), ..., (c_{i_1}, ..., c_{i_n}))$ observed at grid level with probabilities $((p_1^{j_1}, ..., p_I^{j_1}), ..., (p_1^{j_m}, ..., p_I^{j_m})$. These probabilities are normalized so that they add up to one for each individual. Thus, by summing probability sequences of all individuals, we get present population counts at grid level, which add up to the number of distinct Orange customers in the 2007 dataset. A simplified example of this process is presented in figure \@ref(fig:exspatialmap).

<!-- -------------------------------------------------------------------------- -->

\begin{figure}[!h]
\caption{Example of spatial mapping using the bayesian framework}
\label{fig:exspatialmap}
\centering
\subfloat[]{
\includegraphics[width=0.3\textwidth]{sections/3_orange2007/ex_voronoi_to_grid/voro1.png}}
\qquad
\subfloat[]{
\includegraphics[width=0.3\textwidth]{sections/3_orange2007/ex_voronoi_to_grid/voro2.png}}

\subfloat[]{
\includegraphics[width=0.28\textwidth]{sections/3_orange2007/ex_voronoi_to_grid/grid1.png}}
\qquad
\subfloat[]{
\includegraphics[width=0.28\textwidth]{sections/3_orange2007/ex_voronoi_to_grid/grid2.png}}
\qquad
\subfloat[]{
\includegraphics[width=0.28\textwidth]{sections/3_orange2007/ex_voronoi_to_grid/grid3.png}}

\subfloat[]{
\includegraphics[width=0.3\textwidth]{sections/3_orange2007/ex_voronoi_to_grid/prior1.png}}
\qquad
\subfloat[]{
\includegraphics[width=0.3\textwidth]{sections/3_orange2007/ex_voronoi_to_grid/prior2.png}}

\fnote{Lecture : this plot illustrates home detection process for a given phone user with a fictive example.
We focus on two specific Voronoi polygons $v_1$ and $v_2$ (a). Let's assume that, over the month, 2/3 of the nightly phone events of the user are located in $v_2$ — i.e. processed by the corresponding antenna — and 1/3 are located in $v_1$ (b). We allocate these events to the grid based on conditional probabilities $(\mathbb{P}(t_i | v_j))_{i,j}$, computed via Bayes' formula. If allocation is performed using only relative shares of tiles in the Voronoi polygon they intersect (see (c) and (d)) — i.e. if we use an uninformative prior equal to 1 for all tiles — then probabilistic home detection is given by (e). But let's assume that housing volumes are higher in tiles located at the South of the grid (f). In this case, probabilistic home detection is modified when the prior is incorporated (g).}
\end{figure}

<!-- -------------------------------------------------------------------------- -->

The ability to add any available prior information on grid tiles is a distinctive feature of the bayesian model of localization. It proves especially useful when no technical information on antennae is available. Indeed, if we choose an uninformative prior equal to one for all observations, events are mapped on grid tiles based solely on their relative share in the Voronoi polygon which they intersect. In this case, the model basically boils down to an estimation directly at Voronoi level[^edge_effects], as events are assumed to be uniformly distributed over the tiles wich intersect a given Voronoi polygon. Sakarovitch et al. (2019) show that this uniform interpolation — which they perform at city level — is actually the main cause of estimation error, with an almost one for one ratio. Since adding prior information is what fundamentally allows localization of phone users to depart from a purely Voronoi based one, it has important potential for mitigating such interpolation error.

[^edge_effects]: Actually, some changes can occur for tiles which intersect two or more Voronoi polygons, since events are mapped on tiles based on their relative share in the polygon(s) they intersect. Figure \@ref(fig:exspatialmap) illustrates such a case. In practice, such edge effects produce limited change in population estimates at tile level for two reasons. First, most Voronoi polygons over the territory have substantial size and thus contain many tiles (see figure \@ref(fig:exspatialmap)), which limits edge effects occurrence. Second, because population distributions generally exhibit high level of spatial autocorrelation (see section \@ref(spatialmetrics2007) for a detailed discussion over this concept). Thus, nearby Voronoi polygons tend to be similar in terms of population density, which limits the magnitude of edge effects.

### Statistical adjustement of the sample

The final step of the detection process is to make resulting estimates comparable with general population. They can diverge for two main reasons. First, population estimates are computed using data from customers of a single MNO (Orange), who represent only a given share of the population. Second, we must take into account the penetration rate of mobile phones, i.e. the fact that some people don't own any phone whereas some people own several ones. Furthermore, there rates are known to be quite heterogeneous over the territory. To overcome these issues, we must adjust our sample in the following way :
$$
\widehat{N}_i = \frac{N_{PHD_i}}{\tau_i.\alpha_i}
$$
where $N_{PHD_i}$ represents population count of spatial unit $i$ resulting from the probabilistic home detection, $\tau_i$ the penetration rate in spatial unit $i$, and $\alpha_i$ Orange market share in spatial unit $i$. Similarly to Sakarovitch et al. (2019), we adjust our sample to make it representative of general population using Orange customer relationship management (CRM) in 2007 at department level. The number of Orange customers living in department k is estimated using customers addresses in this list. Since addresses are not available for all customers, we adjust by the size of this file. Finally, we obtain department $k$ market share by dividing the estimated number of customers living there by the total number of people living in this departement according to tax data :
$$
\widehat{\tau_k.\alpha_k} = \frac{\frac{Tot_{PHD}}{Tot_{CL}}.N_{CL_k}}{N_{TAX_k}}
$$
These adjustments place our population estimates in a same order of magnitude as localized tax data, and thus enables to compare distributions over the territory.

<!-- -------------------------------------------------------------------------- -->

### Validation metrics {#metrics2007}

In order to evaluate the performance of the bayesian model of localization, we rely on several metrics to compare population estimates with validation data. First, we estimate Pearson's $r$ correlation coefficient, which is the most used indicator in similar works (Deville et al., 2014 ; Vanhoof et al., 2018 ; Sakarovitch et al., 2019). For a vector of population estimates $\vec{x}$ and a vector of validation population data $\vec{y}$ of the same length n — the number of grid tiles — it is defined as :
$$
r(\vec{x}, \vec{y}) = \frac{\sum_{i=1}^n (x_i- \bar{x}) (y_i- \bar{y})}{\sqrt{\sum_{i=1}^n (x_i- \bar{x})^2 \sum_{i=1}^n(y_i- \bar{y})^2}}
$$
Pearson's $r$ indicates both direction and strength of the linear relationship between estimates and validation vectors. However, it is known to be quite sensitive to outliers in either or both compared distributions (Kim et al., 2015). Spatial distributions of population tend to be heavily skewed to the right because of high heterogeneity between rural and urban areas and are prone to heteroscedasticity issues, which makes comparison between correlation coefficients difficult (Wilcox, 2009). Furthermore, they generally exhibit high degree of spatial autocorrelation — i.e. spatially close observations are similar to each other — which requires specific testing procedure to avoid spurious correlation (Clifford et al., 1989). To deal with these limitations, we also estimate Spearman's $\rho$ rank correlation coefficient. If we denote by $\overrightarrow{rg_x}$ and $\overrightarrow{rg_y}$ the respective rank ordering vectors of $\vec{x}$ and $\vec{y}$, then Spearman's $\rho$ is obtained by computing Pearson's correlation coefficient over the rank vectors :
$$
\rho(\vec{x}, \vec{y}) = r(\overrightarrow{rg_x}, \overrightarrow{rg_y})
$$
Spearman's correlation test is less restrictive than Pearson's in the sense that it assesses any monotonic relationship between estimates and validation vectors, not only a linear one. This property makes it useful for comparison of spatial distributions of population, which often exhibit nonlinearities. Besides, the rank transformation makes it robust to the presence of outliers.

The statistical adjustment we make using Orange client list enables us to directly quantify differences between estimates and validation counts. Again, we use two different metrics to do so in order to take into accounts specificities of population distributions. First, we estimate the root mean squared error (RMSE) — also often called root mean squared deviation (RMSD). Using the same notations as above, it is defined formally as :
$$
RMSE(\vec{x}, \vec{y}) = \sqrt{\frac{1}{n} \sum_{i=1}^n (y_i - x_i)^2}
$$
We also estimate the mean absolute error (MAE), defined as :
$$
MAE(\vec{x}, \vec{y}) = \frac{1}{n} \sum_{i=1}^n |y_i - x_i|
$$
These two measures are both frequently employed as accuracy measures of statistical models. They share many properties : they both express *average* error in units of the variable of interest, here population counts. Besides, they are both defined on $\mathbb{R}^+$ and negatively-oriented (the closer to 0, the better the quality of estimates). But there is also a very important difference between these two metrics, due to the way they are defined : taking the square root of errors before avering in the RMSE gives more weight to large errors of prediction. In our case, this can be either desirable or not : on the one hand we would like to penalize large under- and over- estimates of population, on the other the potential presence of very important outliers can significantly affect the metric. We thus choose to also rely on MAE, which is much less prone to this issue since all errors are weighted equally (see Willmott & Matsuura, 2005 and Chai & Draxler, 2014 for a detailed discussion, and a case for using and comparing both metrics in statistical applications in the latter).

<!-- -------------------------------------------------------------------------- -->

### Accouting for the spatial dimension of population repartition {#spatialmetrics2007}

The validation metrics we presented above summarize the statistical link between estimates and validation distributions, and enable an evaluation of mean estimation error. However, they are aspatial in nature, in the sense that they would give identical results for any random permutation of grid tiles on the map. Yet population repartition patterns are obviously far from being randomly distributed, with high population densities in cities and their suburbs, and conversely low population densities in rural areas. Furthemore, transitions from low density to high density areas tend to happen in a smooth way rather than abruptly. This property, which characterizes most spatial distributions, is called spatial autocorrelation : neighbouring spatial units tend to exhibit similar values of a given variable. Against that background, another important way to evaluate the quality gain of our estimates is thus to check whether they are able to reproduce the underlying spatial structure of resident population repartition. We resort to spatial analysis tools to explore this demension.

First, we can determine whether the distributions we analyze are characterized by the presence of spatial autocorrelation. Several indices have been developped for this purpose. Generally speaking, they consist in computing the correlation between spatially close observations of a given phenomenon. "Closeness" is assessed by a spatial weights matrix W, whose elements $(w_{ij})_{i,j}$ are such that $w_{ij} = 1$ if grid tiles $i$ and $j$ are contiguous[^spatial_matrix]. If we denote the observed variable as $\vec{x}$, the general form of spatial autocorrelation indices is given by :
$$
Corr(Y, WY) = \frac{Cov(Y, WY)}{\sqrt{V(Y)V(WY)}}
$$
In this study, we choose to rely on Moran's I index (Moran, 1948), which is often preferred to other spatial autocorrelation indices in the literature beacause of greater stability (Upton et al., 1985). Keeping the same notations as above, it is defined as :
$$
I_W = \frac{n}{\sum_i \sum_j w_{ij}}\frac{\sum_i \sum_j w_{ij}(x_i-\bar{x})(x_j-\bar{x})}{\sum_i(x_i-\bar{x})^2} \:\:\: \text{for} \: i \neq j
$$
Moran's I enables to test whether neighbouring observations co-vary relatively to the variance of the distribution. The null hypothesis is that neighbours do not co-vary in any particular way, in which case $I_W = 0$. A strictly positive Moran's I indicates positive spatial autocorrelation, meaning that similar values of the observed variable tend to cluster geographically. The test is performed using the z-score :
$$
\frac{I_W - E(I_W)}{\sqrt{V(I_W)}} \overset{H_0}{\sim} \mathcal{N}(0,1)
$$
where :
$$
E(I_W) = - \frac{1}{n-1}
$$
and :
$$
V(I_W) = \frac{n[(n^2-3n+3)S_1-nS_2+3S_0^2]-k[(n^2-n)S_1-2nS_2+6S_0^2]}{(n-1)(n-2)(n-3)S_0^2}
$$
with $S_0 = \sum_i \sum_j W_{ij}$, $S_1 = 2 \sum_i\sum_j W_{ij}$, $S_2 = 4 \sum_i W_{i.}^2$ and $k = \frac{\sum_i (x_i-\bar{x})^4/n}{(\sum_i (x_i-\bar{x})^2/n)^2}$.

[^spatial_matrix]: There are many other possible ways to define neighbourhood structure : based on a distance, taking a given number of nearest neighbours, etc. We choose to rely on contiguity for simplicity purpose : computing a contiguity matrix involves much less operations than computing distances between pairs of tiles. This is particularly important in our case due to the high number of grid tiles.

Moran's I makes it possible to test for the presence of spatial autocorrelation in the distributions we analyse. In particular, it is useful to check whether the distributions of estimation errors exhibit spatial autocorrelation, which can highlight possible systematic bias of our model. Yet, Moran's I doesn't provide any information on the specific structure of autocorrelation when its presence is acknowledged. As such, it is thus not sufficient to determine which of our estimates distributions better replicate the actual spatial structure of resident population repartition. Surprisingly, the literature dealing with the problem of statistically comparing two maps is rather sparse, and no fully satisfactory solution emerges. Lee (2001) develops a bivariate spatial association measure by integrating Pearsons'r and Moran's I in a single statistic. However, this so-called L statistic has undesirable properties. First, the value of the L statistic between a given spatial distribution and itself is not equal to one but rather to a measure of the spatial autocorrelation level exhibited by the distribution, which renders difficult its interpretation. Second, the measure remains based on Pearson's r and thus can still be significantly altered when outliers are present. Levine et al. (2009) propose a statistical procedure for comparing outputs from ecological niche models. But it relies on the hypothesis that mean pixel difference scores have a normal distribution, which appears unlikely in our case due to the aforementioned peculiarities of population distributions. Finally, another possibility we explored was to use local spatial autocorrelation measures, such as Moran's local I (Anselin, 1995). These measures quantify the degree of spatial autocorrelation exhibited by each spatial unit — in our case, each tile of the grid — based on its value and the values of its neighbours. Such an approach has been used by Wulder et al. (2007) to compare outputs from a forest growth model. An important shortcoming of these measures is that they are very computationally expensive to compute as they are not easily vectorized, due to their local nature. As a result, we could only compute them in areas of limited size.

Against these limitations of spatial analysis tools to compare the spatial structures of two distributions, we also provide an analysis inspired by fractal geometry, similar to Sémécurbe et al. (2018). Basically, it consists in comparing the way population is spatially distributed at several nested spatial resolutions. We consecutively aggregate our 500x500 meters grid into 1km, 2km, 4km, 8km and 16km grids respectively. For each population distribution (home detection with uniform prior, home detection with land use prior and localized tax data), we compute an entropy measure at each resolution to summarise the amount of information contained in the distribution. Then, again for each population distribution, we compute the differences in entropy between subsequent scales — these differences correspond to the fractal dimensions — which intuitively represent the amount of information required to be able to transition from the aggregated level to the disaggregated level. Equivalently, it quantifies the degree of randomness of the spatial structure of the distribution : a fractal dimension close to 2 indicates a uniform distribution, whereas a fractal dimension close to 0 characterizes a highly concentrated distribution. Many entropy measures can be used to perfom the analysis, which are all based on Rényi's general formula of entropy (Rényi, 1961).
$$
H_\alpha(X) = \frac{1}{1-\alpha} \text{log} \sum_i P(X=x_i)^{\alpha}
$$
where X is a random variable representing population repartition over the grid, normalized so that~$\sum_i P(X=x_i) = 1$. In particular, the limiting value of $H_{\alpha}$ as $\alpha \rightarrow 1$ is the Shannon entropy (Shannon, 1948), widely used in information theory.

<!-- -------------------------------------------------------------------------- -->

### Computation of results

Let's briefly detail how the steps of the analysis are carried out in practice to produce the results presented below. Computation of priors and posterior distributions is performed using the R functions presented in the previous section. The output of this first step is a table which gives for each Voronoi-grid intersection the value of the posterior, for each available prior. This table is then used as an input for the home detection step. Because of the massive amount of data that CDR represent — several terabytes in total — this second step is performed using big data framework Spark on an HDFS (Hadoop Distributed File System — distributed storage platforms specifically designed for big data tasks) infrastructure, at the MNO office. The output of the second step is a table which gives for each prior estimated population counts over the grid. Finally, computation of statistics on this table are performed using R again, and spatial representations are produced using QGIS (an open source geographic information system (GIS) application optimized for viewing spatial data), apart from kernel smoothing which is performed using the R package *btb*.

## Results

Two configurations of the bayesian model of phone users localization are estimated. In the first one, we use an uninformative prior equal to one. We call it "uniform prior" because it assumes that probabilities of a given phone event are uniformly distributed over the tiles which intersect the Voronoi polygon in which it is detected. This configuration is very close to what has been used in the literature using Orange 2007 CDR dataset (notably Galiana et al., 2018), and thus constitues our baseline estimates. In the second configuration, we estimate the bayesian model with a land use prior, which we also call "bdtopo prior" in reference to the statistical source from which it was computed. Below, we present several analyses which aim at quantifying the gain in accuracy of population counts due to the land use prior. To do so, we compare population distributions computed with each prior to the reference one, computed from localized tax data.

First, we plot the two estimated population distributions as well as the reference one over the grid at France level (maps (a), (b) and (c) of figure \@ref(fig:densitepop2007)). These maps enable a direct visual comparison of spatial repartition of the population in each configuration. Since distributions are heavily right-tailed, we use log transformation for better representation. Tiles with no inhabitant are classified in the lowest density range. Map (a) shows that we are still highly reliant on the Voronoi approximation, as shapes of Voronoi polygons appear quite clearly[^not_voronoi_maps]. It also highlights one of the main limitation of this hyptohesis : when comparing with reference (c), it appears that the population of many areas is overestimated. Most specifically, it seems that a lot of rural areas — characterized by large size Voronoi polygons — are slightly to severely overestimated. Urban areas appear too big in size as compared to reference, leading to visible overestimates in their suburbs. Comparatively, the distribution of population estimated using land use prior appears much more similar to the reference one. Adding the prior dramatically improves the replication of sparsity of population distribution over French territory. This first analysis can be confirmed by plotting in each tile difference to reference data regarding population counts, for each prior (maps (d) and (e)). Again, we observe that the main effect of adding the land use prior is to "clean" layers of population overestimation, particulary around important cities. However, at first glance, the land use prior doesn't seem to solve issues of either under- and over-estimation in large cities, particularly noticeable for Paris and its suburbs.

[^not_voronoi_maps]: We shall make emphasize that in map (a), we are not representing population counts per Voronoi polygon. Such a map would be semantically incorrect, since Voronoi polygons are heterogenous in size. Here, population counts are represented over (regular) grid tiles. The fact that Voronoi polygon shapes appear is a direct consequence of the Voronoi approximation we rely on for the estimation and the fact that using an uniform prior doesn't modify the distribution.

<!-- -------------------------------------------------------------------------- -->

\newgeometry{top=5mm, bottom=5mm, left=5mm, right=5mm}
\begin{figure}[h]
\caption{Population counts from probabilistic home detection (PHD) at France level}
\label{fig:densitepop2007}
\centering

\subfloat[][PHD with uniform prior]{
\includegraphics[width=8cm, height = 9cm]{sections/3_orange2007/phd_uniform.png}}
\qquad
\subfloat[][PHD with land use prior]{
\includegraphics[width=8cm, height = 9cm]{sections/3_orange2007/phd_bdtopo.png}}

\subfloat[][Reference : localized tax data]{
\includegraphics[width=8cm, height = 9cm]{sections/3_orange2007/rfl.png}}

\subfloat[][Difference between PHD with uniform prior and reference]{
\includegraphics[width=8cm, height = 9cm]{sections/3_orange2007/diff_uniform_rfl.png}}
\qquad
\subfloat[][Difference between PHD with land use prior and reference]{
\includegraphics[width=8cm, height = 9cm]{sections/3_orange2007/diff_bdtopo_rfl.png}}

\end{figure}
\newpage
\restoregeometry

<!-- -------------------------------------------------------------------------- -->

This graphical assessment of the quality gain of population estimates due to the land use prior can be confirmed by a statistical comparison of the two estimated distributions with the reference one (table \@ref(tab:metrics2007)). We use the various validation metrics presented in section \@ref(metrics2007). First, we compare Pearson's $r$ linear correlation coefficient. Using this metric, the gain from using the land use prior appears rather small (ten percentage points), thus contrasting sharply with graphical comparison. However, as previously discussed, multiple issues arise when comparing correlation coefficients with distributions such as population counts. As evident from figure \@ref(fig:scatterphdref), population distributions are heavily concentrated around low values, but exhibit very long right tales. It is thus likely that outliers artificially increase correlation coefficients : very high values of population estimates co-occur with very high values of validation population. Furthermore, these distributions exhibit obvious heteroscedasticity[^log_transformation]. Comparison of Spearman's $\rho$ coefficients appears to confirm this analysis. The coefficient with uniform prior is seriously reduced (39 percentage points) while the coefficient with land use prior improves (8 percentage points). Correlation analysis performed using Spearman's coefficient thus suggests a dramatic improvement of the shape of population estimates distribution due to the land use prior which was not captured using Pearson's coefficient.

[^log_transformation]: A method which is often used to mitigate the effects of outliers and heteroscedasticity in such distributions is to apply log transformation to variables of interest. Here, this method is problematic since population distributions over the French territory exhibit high proportion of uninhabited tiles whereas the log function is not defined in zero. We use it for representation purpose in figure \@ref(fig:densitepop2007) by classifying uninhabited tiles with lowest density tiles. However, it wouldn't be rigorous to perform correlation analysis using this simplification.

<!-- -------------------------------------------------------------------------- -->

\begin{table}[t]
\caption{Comparison for each prior of population counts with reference (tax data) using various metrics}
\label{tab:metrics2007}
\setlength{\tabcolsep}{5pt}
\centering
\begin{tabular}{@{} l SSSS @{}}
\toprule
Prior   &  \multicolumn{4}{c @{}}{Metric }\\
\cmidrule(l){2-5}
    & {Pearson's $r$} & {Spearman's $\rho$} & {Root mean squared error} & {Mean absolute error}  \\
\midrule
Uniform & 0.69 & 0.3 & 159.5 & 32.6 \\
Bdtopo & 0.79 & 0.87 & 149.7 & 16.8 \\
\bottomrule
\end{tabular}
\end{table}

<!-- -------------------------------------------------------------------------- -->

\begin{figure}[t]
\caption{Scatter plots of tax data population counts against probabilistic home detection (PHD) estimates}
\label{fig:scatterphdref}
\centering

\subfloat[][PHD with uniform prior]{
\includegraphics[width=\textwidth]{sections/3_orange2007/scatter_uniform_rfl.png}}

\subfloat[][PHD with land use prior]{
\includegraphics[width=\textwidth]{sections/3_orange2007/scatter_bdtopo_rfl.png}}

\end{figure}

<!-- -------------------------------------------------------------------------- -->

We come to similar conclusions when we assess average estimation errors relatively to validation data. Using root mean squared error (RMSE), we find that including the land use prior reduces average error by only 6 %. However, using mean absolute error (MAE) gives very different results. First, errors of estimation are much less important (PHD misallocates between 16 and 32 people by tile on average, against 150 to 160 using RMSE). Besides, the improvement due to the land use prior is much more pronounced : the average error rate is halved. As discussed before, this difference in conclusions between the two metrics is likely due to the way they are defined : RMSE gives much more weight to important errors, whereas MAE weights all errors equally. This discrepancy thus tends to confirm the analysis we made by comparing maps of distributions in figure \@ref(fig:densitepop2007) : the land use prior removes small to moderates errors, but it doesn't solve issues of important under- and over-estimation which are observed in big cities and their suburbs (also clearly visible in figure \@ref(fig:scatterphdref)).

<!-- -------------------------------------------------------------------------- -->

\begin{figure}[h]
\caption{Advantage and shortcoming of land use prior for probabilistic home detection (PHD)}
\label{fig:proconprior2007}
\centering

\subfloat[][Share of grid tiles wrongly declared as populated by PHD]{
\includegraphics[width=0.43\textwidth]{sections/3_orange2007/compar_overpop_PHD.jpg}}
\qquad
\subfloat[][Share of grid tiles wrongly declared as empty by PHD]{
\includegraphics[width=0.43\textwidth]{sections/3_orange2007/compar_empty_PHD.jpg}}

\fnote{Lecture : the first graph shows the share of grid tiles (y-axis) in which probabilistic home detection (PHD) allocates n people (x-axis) whereas there should be none according to reference (tax data). The second graph shows the share of grid tiles in which PHD allocates no people whereas there should be n people according to reference.}

\end{figure}

<!-- -------------------------------------------------------------------------- -->

This last claim is further confirmed when we compare estimates with each prior depending on tile's "true" population according to validation data. 50 % of empty tiles are rightly declared as not populated with land use prior, against only 2 % with uniform prior. In figure \@ref(fig:proconprior2007), we extend this analysis by comparing misallocations with each prior, depending on tile's population. Graph (a) confirms that the land use prior greatly reduces the number of grid tiles in which some people are detected whereas there should be none according to tax data. Conversely, graph (b) points out that the land use prior tends to result in too many tiles declared as empty whereas they shouldn't be. However, this latter effect is of very limited magnitude, which strongly supports the use of land use prior in the bayesian model of localization.

Statistical analysis substantiates the improvement in population estimates quality due to the land use prior. But apart from the visual comparison of maps done with figure \@ref(fig:densitepop2007), we didn't take into account the spatial dimension in the analysis. Indeed, all the results presented above would hold true for any random permutation of the grid on the map. However, spatial autocorrelation — or lack thereof — is a major property of spatial distributions, which we must take into account for comparisons to be relevant. We thus resort to spatial analysis tools in order to describe this dimension of population counts.

Table \@ref(tab:globalmoran2007) displays the results of the testing procedure for the presence of spatial autocorrelation, based on global Moran's I statistic. All three population distributions, the two estimated ones and the validation one, exhibit significant and substantial levels of spatial autocorrelation. Besides, the ordering of the coefficients appear consistent. PHD with uniform prior exhibits the highest level of autocorrelation : since population is distributed uniformly in each Voronoi polygon, most neighbouring tiles display the same population count. Conversely, PHD with land use prior exhibits the lowest level of autocorrelation. This might be explained by its tendency to declare too much tiles as having no building volume (see figure \@ref(fig:proconprior2007)), which mechanically set them as empty, whatever the number of phone calls detected in the corresponding Voronoi polygon. We also find that estimation errors, computed as absolute difference between home detection with each prior and localized tax data, are characterized by significant spatial autocorrelation. This result is consistent with the findings obtained by visual inspection of maps (d) and (e) of figure \@ref(fig:densitepop2007) : with both priors, there are evidence of substantial clustering of overestimation in urban centers and of either over- or under-estimation in city suburbs. More surprising is the fact that they exhibit a similar level of clustering : for the same reasons as explained above, errors tend to be the same for whole Voronoi polygons when using uniform prior, so that we could have expected higher spatial autocorrelation. However, the main effect of incorporating the land use prior is precisely to remove this type of errors in rural and peri-urban areas. We thus end up with a similar level of clustering, since tiles with no more error are mechanically grouped together.

\begin{table}[t] \centering
\caption{Spatial autocorrelation of population distributions and estimation errors}
\label{tab:globalmoran2007}
\begin{tabular}{@{\extracolsep{5pt}} lcc}
\hline \\[-1.8ex]
Variable & Moran's I & p-value \\
\hline \\[-1.8ex]
PHD with uniform prior & 0.78 & 0.00 \\
PHD with land use prior & 0.69 & 0.00 \\
Local tax data & 0.74 & 0.00 \\
Estimation error with uniform prior & 0.37 & 0.00 \\
Estimation error with land use prior & 0.36 & 0.00 \\
\hline
\end{tabular}
\end{table}

While spatial analysis tools are useful to detect the presence of autocorrelation in the distributions, it is yet not sufficient to determine whether we better reproduce the underlying spatial structure of resident population repartition. We thus propose a method inspired by fractal analysis to try to quantify the additional information on the spatial structure of population provided by the use of the bdtopo prior (figure \@ref(fig:scalediff)). The comparison of entropy evolution distributions suggests that adding the land use prior substantially improves the replication of changes in information over scales, as evident from the proximity of the curves corresponding to localized tax data and PHD with the bdtopo prior. Besides, the ordering of the curves appears coherent : the values of information differences over scales using the uniform prior are consistently above the two others, confirming the much higher uniformity of this distribution observed in figure \@ref(fig:densitepop2007). Not surprisingly, the distributions converge for the higher scales : at these levels of aggregation, differences in population counts between spatial units are much less heterogeneous, so that no distribution stands out in terms of information structure.

<!-- -------------------------------------------------------------------------- -->

\begin{figure}[h]
\caption{Effect of scale change on Shannon's entropy measure}
\label{fig:scalediff}
\centering
\includegraphics[width=\textwidth, height = 7cm]{sections/3_orange2007/scale_diff_analysis.png}
\end{figure}

<!-- -------------------------------------------------------------------------- -->

Another way to take into acount the spatial dimension of population repartition is to simply decline the statistical analysis at disaggregated level so as to highlight spatial disparities in quality of home detection. Since the statistical adjustment of the sample was done at department level, it makes sense to replicate the analysis at that level. In figure \@ref(fig:evaldep2007), we plotted MAE and RMSE relative evolutions between PHD with uniform and land use prior for each French department. Again, important differences between the two metrics are observed, due to the way errors are weighted in each case. Although fine interpretation of divergence between the two metrics proves difficult, a particular pattern emerges : important quality improvements of estimates with the land use prior seems to be very often localized in rural areas, whereas departments where major French cities are located appear to benefit the less from the prior addition. This pattern is consistent with our previous results, which show that the land use prior doesn't solve substantial under- and over-estimation which happen in important cities and their suburbs.

<!-- -------------------------------------------------------------------------- -->

\begin{figure}[h]
\caption{Accuracy gain of population counts due to the use of land use prior at department level}
\label{fig:evaldep2007}
\centering

\subfloat[][Relative change in mean absolute error (MAE) due to adding bdtopo prior]{
\includegraphics[width=0.43\textwidth, height = 9cm]{sections/3_orange2007/diff_mae_dep.png}}
\qquad
\subfloat[][Relative change in root mean squared error (RMSE) due to adding bdtopo prior]{
\includegraphics[width=0.43\textwidth, height = 9cm]{sections/3_orange2007/diff_rmse_dep.png}}

\end{figure}

<!-- -------------------------------------------------------------------------- -->

As an illustration of this finding, we focus on two examples at opposite ends of the spectrum as regards quality evolution of estimates (figure \@ref(fig:comparzooms2007)). Meuse belongs to the departments which benefit the most from adding the land use prior, according to both performance metrics (MAE is reduced by 64 % and RMSE by 31 %.). In subplots (a) and (b), we plotted absolute differences between counts from PHD and those from validation data in Meuse, for each prior. Subplot (a) highlights quite clearly the limitations of the Voronoi hypothesis : since people likely place of residence are allocated uniformly in the Voronoi polygon in which they are detected, estimation errors tend to affect all the tiles intersecting the Voronoi polygon. This major source of bias is greatly reduced when we estimate PHD using the land use prior, as it eliminates tiles with low volume of housing in which it is unlikely that people spend the night. This effect of the land use prior is observed in all rural areas, as well as nearby moderate size cities. On the contrary, its effect appears very limited in crowded urban areas. This is for instance blatant in Paris and its immediate suburbs, which belong to areas exhibiting lowest RMSE and MAE reductions with the land use prior. Differences between estimates and validation data are again plotted for comparison (subplots (c) and (d)). As nearby tiles can exhibit substantial heterogeneity in this area, we resort to kernel smoothing so as to facilitate visualization[^smoothing]. Although some local differences arise, the two distributions appear almost identical, confirming the inability of the land use prior to mitigate estimation issues which arise in important cities and their vicinity. This result holds true in other major French cities, although to a lesser extent due to the specificities of Paris.

[^smoothing]: More specifically, distributions are smoothed using a bisquare kernel over a 100x100 meters grid, with bandwith parameter ("size" of the neighbourhood on which computations are carried out) set to 2km. See Genebes, Renaud & Sémécurbe in Loonis & De Bellefon (2018) for a detailed presentation of kernel smoothing.

## Limits

Our results indicate substantial improvement of the quality of population estimates due to adding prior information on land use in the bayesian model of localization. Specifically, the main effect of the land use prior appears to be the removal of small to moderates overestimation errors all over French territory. However, it doesn't solve issues of major under- and over-estimation which characterize important cities and their suburbs. Various explanations can be put forward to explain the existence of these errors and the fact they are not mitigated by the addition of prior information on tiles.

First, we still rely on the Voronoi approximation to estimate population counts. When a phone event is localized in a given Voronoi polygon, the use of prior information on tiles will just ensure that it is projected on the grid in a relevant way, i.e. by taking into account unequal probabilities of nightly presence on the territory. However, the event remains bound to be allocated to tiles which belong to or intersect the Voronoi polygon, whereas it is entirely possible that the user is actually localized in another Voronoi polygon. This shortcoming alone could constitutes a major source of the misallocations observed in urban areas. In rural areas, where antennae distribution is very sparse and thus Voronoi polygons much wider than average, the Voronoi approximation seems more justified : in such configuration, antenna cells tend to be macro cells (i.e. cells covering very wide areas, often in a circular way) and thus the approximation can actually fit technical reality. On the contrary, it doesn't appear justified in urban areas : as evident from figure \@ref(fig:voronoi2007), Voronoi polygons are much smaller in urban reas, and are even often smaller than grid tiles in centers of major cities. In this case, the Voronoi approximation produces substantial bias since it doesn't account for overlapping of antennae coverage areas. Besides, adding prior information on land use doesn't make any change because of low number of tiles per Voronoi polygons, and the fact that housing tends to be uniformly distributed in dense areas. Availability of antennae coverage maps based on waves propagation models from the MNO could highly mitigate this source of error.

Another potential explanation for these errors could be that the concept of present population we measure is not the same over the territory. Urban areas are characterized by distinctive behaviours : tourism, the importance of social activities (restaurants, movies theaters, ...), different working hours, etc. As a result, the time window to which we restrict the sample of mobile phone events (19:00 to 09:00) — chosen so as to provide information regarding places of residence, while at the same time ensuring sufficient nightly observations because of tracks temporal scarcity — might capture more events which interfere with home detection than in rural areas. A careful examination of overestimation areas in major French cities gives weight to this hypothesis : overestimation particularly occurs in places known to be highly touristic (historical city centers, commercial areas, places with a lot of hotels...) as well as in transport key points (railway stations, airports). The land use prior fails to mitigate this type of errors because these areas are generally residential, and transport key points are classified in BD Topo "Bâti indifférencié" type because of their public nature. This analysis suggests that some of the differences between estimates and validation data in urban areas may not be errors, but simply due to measuring temporarily present population rather than nightly residing one. The much greater temporal resolution of tracks from signalling data could help optimize time span restriction.

Finally, some limitations associated to the data sources we exploit might explain observed differences in a more general way. For availability reasons, we are constrained to deal with data sources observed at different temporality — 2007 for mobile phone data, 2011 for localized tax data, and 2015 for BD Topo. We thus make the hypothesis that evolutions are not meaningful enough to produce significant bias. Besides, some differences might be produced by the statistical adjustment of the sample. It relies on Orange client list in 2007, which quality is uncertain. It is also possible that market shares and penetration rate vary at finer levels than the departmental one.

<!-- -------------------------------------------------------------------------- -->

\newgeometry{left=5mm, right=5mm}
\begin{figure}[h]
\caption{Comparison of prior effect in rural and urban areas}
\label{fig:comparzooms2007}
\centering

\subfloat[][Difference between PHD with uniform prior and reference : zoom on Meuse department]{
\includegraphics[width=12cm, height = 9cm]{sections/3_orange2007/diff_uniform_meuse.png}}
\qquad
\subfloat[][Difference between PHD with land use prior and reference : zoom on Meuse department]{
\includegraphics[width=12cm, height = 9cm]{sections/3_orange2007/diff_bdtopo_meuse.png}}

\subfloat[][Difference between PHD with uniform prior and reference : zoom on Paris and immediate suburb]{
\includegraphics[width=9cm, height = 8cm]{sections/3_orange2007/diff_uniform_paris_lisse.png}}
\qquad
\subfloat[][Difference between PHD with land use prior and reference : zoom on Paris and immediate suburb]{
\includegraphics[width=9cm, height = 8cm]{sections/3_orange2007/diff_bdtopo_paris_lisse.png}}

\end{figure}
\newpage
\restoregeometry

<!-- -------------------------------------------------------------------------- -->
